<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Segments: the atoms of geometry • wkpool</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Segments: the atoms of geometry">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wkpool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/wkpool.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/wkpool-vignette-segments.html">Segments: the atoms of geometry</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/wkpool/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Segments: the atoms of geometry</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hypertidy/wkpool/blob/main/vignettes/wkpool-vignette-segments.Rmd" class="external-link"><code>vignettes/wkpool-vignette-segments.Rmd</code></a></small>
      <div class="hidden name"><code>wkpool-vignette-segments.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="what-is-a-segment">What is a segment?<a class="anchor" aria-label="anchor" href="#what-is-a-segment"></a>
</h2>
<p>Two connected vertices. That’s it.</p>
<p>A segment is the atom of geometry. Every line is a sequence of
segments. Every polygon boundary is a cycle of segments. Every track
step between consecutive GPS fixes is a segment with a duration. It’s
the simplest spatial primitive that encodes <em>connection</em> rather
than just <em>position</em>.</p>
<p>Simple Features — the dominant spatial data model — hides segments
inside sealed coordinate sequences. A polygon is a ring of coordinates.
A line is a list of coordinates. The connections between consecutive
vertices are implicit. To discover them you extract coordinates, pair
consecutive points, and rebuild the structure yourself. Every time.</p>
<p>wkpool makes segments explicit.</p>
</div>
<div class="section level2">
<h2 id="the-cost-of-sealed-geometry">The cost of sealed geometry<a class="anchor" aria-label="anchor" href="#the-cost-of-sealed-geometry"></a>
</h2>
<p>Consider two adjacent polygons sharing a boundary:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/wkpool" class="external-link">wkpool</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/wk/" class="external-link">wk</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">two_squares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"POLYGON ((0 0, 1 0, 1 1, 0 1, 0 0))"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"POLYGON ((1 0, 2 0, 2 1, 1 1, 1 0))"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In Simple Features, these are two independent geometries. Each owns
its coordinates. The shared edge from (1,0) to (1,1) is duplicated —
encoded separately in both polygons with no structural record that they
share a boundary. To discover the shared edge, you’d need
<code>sf::st_intersection()</code> or equivalent, which runs the full
GEOS machinery on every coordinate.</p>
<p>With wkpool, decompose to segments and the structure is
<em>visible</em>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/establish_topology.html">establish_topology</a></span><span class="op">(</span><span class="va">two_squares</span><span class="op">)</span></span>
<span><span class="va">pool</span></span>
<span><span class="co">#&gt; &lt;wkpool[8 segments, 10 vertices]&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;segment: 1-&gt;2&gt;  &lt;segment: 2-&gt;3&gt;  &lt;segment: 3-&gt;4&gt;  &lt;segment: 4-&gt;5&gt; </span></span>
<span><span class="co">#&gt; [5] &lt;segment: 6-&gt;7&gt;  &lt;segment: 7-&gt;8&gt;  &lt;segment: 8-&gt;9&gt;  &lt;segment: 9-&gt;10&gt;</span></span></code></pre></div>
<p>At this stage every coordinate has been minted as a vertex with an
integer ID, and every consecutive pair within a ring has become a
segment. But the vertices from different features are still separate —
the shared edge exists as duplicate coordinate pairs.
<code><a href="../reference/topology_report.html">topology_report()</a></code> shows the raw state:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/topology_report.html">topology_report</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_vertices_raw</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_vertices_unique</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_duplicate_vertices</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_near_miss_vertices</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_segments</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_shared_edges</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_features</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>Now merge coincident vertices:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_coincident.html">merge_coincident</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/topology_report.html">topology_report</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_vertices_raw</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_vertices_unique</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_duplicate_vertices</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_near_miss_vertices</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_segments</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_shared_edges</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_features</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>After merging, the two copies of (1,0) are now the same vertex ID,
and the two copies of (1,1) are the same vertex ID. The shared boundary
is a structural fact — two segments in different features that reference
the same vertex pair.</p>
</div>
<div class="section level2">
<h2 id="what-becomes-easy">What becomes easy<a class="anchor" aria-label="anchor" href="#what-becomes-easy"></a>
</h2>
<p>With segments as explicit objects, operations that are expensive on
Simple Features become table lookups.</p>
<p><strong>Shared boundaries</strong> — segments that appear in more
than one feature:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_shared_edges.html">find_shared_edges</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt;   edge_key .vx0 .vx1 .feature segment_idx features</span></span>
<span><span class="co">#&gt; 2      2-3    2    3        1           2     1, 2</span></span>
<span><span class="co">#&gt; 8      2-3    2    3        2           8     1, 2</span></span></code></pre></div>
<p>In Simple Features this requires geometric intersection tests. Here
it’s a grouped count on vertex-pair indices.</p>
<p><strong>Neighbours</strong> — which features share structure:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_neighbours.html">find_neighbours</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt;   feature_a feature_b</span></span>
<span><span class="co">#&gt; 3         1         2</span></span></code></pre></div>
<p>The adjacency graph falls out of a self-join on shared segments.</p>
<p><strong>Internal boundaries</strong> — shared edges with opposite
winding, the defining signature of a true polygon boundary (as opposed
to a self-touching ring):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_internal_boundaries.html">find_internal_boundaries</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;wkpool[2 segments, 6 vertices]&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;segment: 2-&gt;3&gt; &lt;segment: 3-&gt;2&gt;</span></span></code></pre></div>
<p><strong>Topology-preserving simplification</strong> — reduce vertex
count while keeping shared boundaries aligned. With wkpool, shared
vertices are identified by index. Simplify the vertex pool, and every
feature that references those vertices updates together. In Simple
Features you simplify each geometry independently, and shared boundaries
drift apart.</p>
</div>
<div class="section level2">
<h2 id="the-full-topology">The full topology<a class="anchor" aria-label="anchor" href="#the-full-topology"></a>
</h2>
<p>wkpool provides the complete arc-node decomposition that Simple
Features leaves implicit.</p>
<p><strong>Vertex degree</strong> tells you where topology is
interesting:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vertex_degree.html">vertex_degree</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 2 3 4 5 6 </span></span>
<span><span class="co">#&gt; 2 4 4 2 2 2</span></span></code></pre></div>
<p>Degree-2 vertices are interior to an arc — they’re the “pass-through”
points. Degree != 2 means a node: a branch point, an endpoint, or a
junction where multiple features meet.</p>
<p><strong>Nodes</strong> — the vertices where topology happens:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_nodes.html">find_nodes</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2 3</span></span></code></pre></div>
<p><strong>Arcs</strong> — maximal sequences of segments between
nodes:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_arcs.html">find_arcs</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 2 1 4 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 2 5 6 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 2 3</span></span>
<span><span class="fu"><a href="../reference/arc_node_summary.html">arc_node_summary</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_vertices</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_nodes</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_arcs</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $degree_distribution</span></span>
<span><span class="co">#&gt; deg</span></span>
<span><span class="co">#&gt; 2 4 </span></span>
<span><span class="co">#&gt; 4 2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $arc_length_distribution</span></span>
<span><span class="co">#&gt; arc_lengths</span></span>
<span><span class="co">#&gt; 1 3 </span></span>
<span><span class="co">#&gt; 2 2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mean_arc_length</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>This is the arc-node model from computational geometry (de Berg et
al. 2008), expressed as data frames rather than linked-list pointer
structures. The same decomposition that PostGIS topology provides as a
heavyweight extension, wkpool provides as a table operation on the
segment pool.</p>
</div>
<div class="section level2">
<h2 id="cycles-and-winding">Cycles and winding<a class="anchor" aria-label="anchor" href="#cycles-and-winding"></a>
</h2>
<p>Cycles are closed loops in the segment graph. For polygon data, they
correspond to rings:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_cycles.html">find_cycles</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="va">cycles</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 5 6 3</span></span></code></pre></div>
<p>Signed area from the shoelace formula distinguishes outer rings from
holes — negative area is an outer ring in the SF convention:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/classify_cycles.html">classify_cycles</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cycle area type</span></span>
<span><span class="co">#&gt; 1     1    1 hole</span></span>
<span><span class="co">#&gt; 2     2    1 hole</span></span></code></pre></div>
<p>This is <em>intrinsic</em> — we observe winding from the coordinate
order, we don’t declare it via metadata. The geometry tells you what it
is.</p>
</div>
<div class="section level2">
<h2 id="the-round-trip">The round trip<a class="anchor" aria-label="anchor" href="#the-round-trip"></a>
</h2>
<p>wkpool decomposes Simple Features into vertices and segments. It goes
back too:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Arcs as linestrings (the topological boundary representation)</span></span>
<span><span class="fu"><a href="../reference/arcs_to_wkt.html">arcs_to_wkt</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;wk_wkt[4]&gt;</span></span>
<span><span class="co">#&gt; [1] LINESTRING (1 0, 0 0, 0 1, 1 1) LINESTRING (1 0, 1 1)          </span></span>
<span><span class="co">#&gt; [3] LINESTRING (1 0, 2 0, 2 1, 1 1) LINESTRING (1 0, 1 1)</span></span>
<span></span>
<span><span class="co"># Cycles as polygons</span></span>
<span><span class="fu"><a href="../reference/cycles_to_wkt.html">cycles_to_wkt</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;wk_wkt[0] with CRS=NA&gt;</span></span></code></pre></div>
<p>This is the “SF at the edges” principle. Read geometry in any format
wk can handle (WKT, WKB, sf, geos, s2). Decompose to vertices and
segments for analysis. Recompose to Simple Features when you need to
write, plot, or hand off to another tool.</p>
<p>Simple Features is the interchange format. Segments are the working
format.</p>
</div>
<div class="section level2">
<h2 id="integration-triangulation">Integration: triangulation<a class="anchor" aria-label="anchor" href="#integration-triangulation"></a>
</h2>
<p>The vertex pool and segment table map directly to constrained
triangulation inputs — no coordinate extraction or reformatting
needed:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># RTriangle PSLG format</span></span>
<span><span class="va">pslg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_pslg.html">as_pslg</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pslg</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ P: num [1:6, 1:2] 0 1 1 0 2 2 0 0 1 1 ...</span></span>
<span><span class="co">#&gt;  $ S: int [1:8, 1:2] 1 2 3 4 2 5 6 3 2 3 ...</span></span>
<span></span>
<span><span class="co"># decido (earcut) format</span></span>
<span><span class="va">dec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_decido.html">as_decido</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dec</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ xy      : num [1:6, 1:2] 0 1 1 0 2 2 0 0 1 1 ...</span></span>
<span><span class="co">#&gt;  $ segments: int [1:8, 1:2] 0 1 2 3 1 4 5 2 1 2 ...</span></span></code></pre></div>
<p>The pool <em>is</em> the PSLG. The mapping is structural, not a
conversion.</p>
</div>
<div class="section level2">
<h2 id="segments-in-movement-data">Segments in movement data<a class="anchor" aria-label="anchor" href="#segments-in-movement-data"></a>
</h2>
<p>wkpool’s insight applies beyond polygons. Track data — animal
movement, vessel tracks, GPS logs — is inherently a sequence of
segments. Each step between consecutive fixes carries a bearing,
distance, speed, and duration.</p>
<p>The traipse package works directly on this segment view:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AustralianAntarcticDivision/traipse" class="external-link">traipse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5 GPS fixes from a Southern Ocean track</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">147.0</span>, <span class="fl">147.5</span>, <span class="fl">148.1</span>, <span class="fl">148.3</span>, <span class="fl">148.0</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">42.0</span>, <span class="op">-</span><span class="fl">42.3</span>, <span class="op">-</span><span class="fl">42.5</span>, <span class="op">-</span><span class="fl">42.2</span>, <span class="op">-</span><span class="fl">41.9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Each function operates on the implicit segment between consecutive points</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/traipse/man/track_bearing.html" class="external-link">track_bearing</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 129.04690 114.41743  26.38024 -36.79846        NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/traipse/man/track_distance.html" class="external-link">track_distance</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]       NA 53088.55 54163.60 37175.89 41559.40</span></span></code></pre></div>
<p>traipse doesn’t construct a LINESTRING and decompose it. It works
directly on the consecutive vertex pairs. The segments <em>are</em> the
data. The trip package builds on this: a trip is a grouped tibble of
ordered coordinates, and every analytical operation runs on the segment
view via <code>dplyr::lead()</code> and <code>dplyr::lag()</code> within
groups. No geometry column, no format conversion, no
decomposition/reconstruction cycle.</p>
</div>
<div class="section level2">
<h2 id="why-this-matters-now">Why this matters now<a class="anchor" aria-label="anchor" href="#why-this-matters-now"></a>
</h2>
<p>Apache Arrow is becoming the universal columnar memory format, and
GeoArrow is defining how geometry lives in Arrow’s layout. A GeoArrow
polygon is already stored as coordinate arrays with offset indices —
structurally closer to a vertex pool than to a sealed WKB blob.</p>
<p>wkpool is a proof of concept for what GeoArrow-native analysis could
look like: work on decomposed vertices and segments directly, without
round-tripping through Simple Features semantics. The same principle
applies in any language.</p>
</div>
<div class="section level2">
<h2 id="the-lineage">The lineage<a class="anchor" aria-label="anchor" href="#the-lineage"></a>
</h2>
<p>The ideas in wkpool trace back to the silicate package (2016), which
explored topological data models for spatial data in R using PATH, ARC,
and SC (segment-and-constraint) models. silicate was the right direction
but required buying into a heavy ontology. wkpool is the lean successor:
just the vertex pool and segment table, built on wk handlers, with none
of the broader model machinery.</p>
<p>As Mark Padgham observed when he found the silicate project:
“segments are prime.” Every network edge, every polygon boundary, every
track step reduces to a segment. They are the universal primitive that
Simple Features was designed to hide.</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>
<code><a href="../articles/wkpool.html">vignette("wkpool")</a></code> — complete API reference with all
functions</li>
<li>The <a href="https://github.com/hypertidy" class="external-link">hypertidy</a> ecosystem:
composable spatial primitives for R</li>
<li>de Berg, M. et al. (2008). <em>Computational Geometry: Algorithms
and Applications</em>. Springer. (Arc-node topology, DCEL)</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
